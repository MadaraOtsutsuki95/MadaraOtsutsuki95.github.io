<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Wheel of Fate — Ретро</title>
<style>
/* ======= Стили ======= */
body {
  text-align: center;
  font-family: "Times New Roman", serif;
  background: radial-gradient(circle, #1a1a1a, #000000);
  color: #d4af37;
}

h1 {
  margin-top: 20px;
  font-weight: normal;
  letter-spacing: 2px;
}

.wheel-container {
  position: relative;
  width: 420px;
  margin: 30px auto;
}

canvas {
  border-radius: 50%;
  background: #111;
  box-shadow: 0 0 30px black;
}

.arrow {
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 16px solid transparent;
  border-right: 16px solid transparent;
  border-bottom: 30px solid #d4af37;
  z-index: 2;
}

button {
  padding: 12px 30px;
  font-size: 18px;
  border: 1px solid #d4af37;
  background: black;
  color: #d4af37;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  background: #1a1a1a;
}

#result {
  margin-top: 20px;
  min-height: 30px;
  letter-spacing: 1px;
  font-size: 18px;
}
</style>
</head>
<body>

<h1>⚔ Wheel of Fate</h1>
<div class="wheel-container">
  <div class="arrow"></div>
  <canvas id="wheel" width="420" height="420"></canvas>
</div>

<button id="spinBtn">Испытать судьбу</button>
<h2 id="result"></h2>

<audio id="spinSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6c1e4f0d9e.mp3"></audio>
<audio id="winSound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_2c8d9e6c7f.mp3"></audio>

<script>
// ====== Настройки категорий ======
const categories = {
  "Мясные продукты": ["Баранина", "Конина", "Телятина"],
  "Молочные продукты": ["Молоко", "Сыр", "Йогурт"],
  "Мучные изделия": ["Хлеб", "Булочка", "Пирог"],
  "Овощи": ["Помидор", "Огурец", "Морковь"],
  "Фрукты": ["Яблоко", "Банан", "Груша"],
  "Сладкое": ["Шоколад", "Конфета", "Торт"]
};

const colors = ["#5a0000","#004d00","#00005a","#5a005a","#5a5a00","#5a2a00"];
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const resultEl = document.getElementById("result");
const spinSound = document.getElementById("spinSound");
const winSound = document.getElementById("winSound");

let currentSegments = Object.keys(categories);
let spinning = false;
let angle = 0;

// ====== Рисование колеса ======
function drawWheel(segments) {
  const centerX = canvas.width/2;
  const centerY = canvas.height/2;
  const radius = canvas.width/2 - 10;
  const segmentAngle = 2 * Math.PI / segments.length;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  segments.forEach((text,i)=>{
    const startAngle = i*segmentAngle;
    const endAngle = startAngle + segmentAngle;

    // сектор
    ctx.beginPath();
    ctx.moveTo(centerX,centerY);
    ctx.arc(centerX,centerY,radius,startAngle,endAngle);
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.strokeStyle = "#d4af37";
    ctx.lineWidth = 2;
    ctx.stroke();

    // текст
    ctx.save();
    ctx.translate(centerX,centerY);
    ctx.rotate(startAngle + segmentAngle/2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#d4af37";
    ctx.font = "14px Times New Roman";
    ctx.fillText(text, radius - 10,5);
    ctx.restore();
  });
}

// ====== Вращение колеса ======
function spinWheel(segments, callback) {
  let spins = Math.random()*3 + 3;
  const segmentCount = segments.length;
  spinSound.play();

  let speed = 0.3;
  let deceleration = 0.995;

  function animate(){
    angle += speed;
    speed *= deceleration;
    drawRotatedWheel(segments, angle);
    if(speed>0.002){
      requestAnimationFrame(animate);
    } else {
      let targetAngle = angle % (2*Math.PI);
      let index = Math.floor((2*Math.PI - targetAngle)/(2*Math.PI)*segmentCount);
      if(index>=segmentCount) index = segmentCount-1;
      callback(segments[index]);
    }
  }
  animate();
}

function drawRotatedWheel(segments, rotation){
  ctx.save();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.translate(canvas.width/2,canvas.height/2);
  ctx.rotate(rotation);
  ctx.translate(-canvas.width/2,-canvas.height/2);
  drawWheel(segments);
  ctx.restore();
}

// ====== Двухуровневая логика ======
spinBtn.addEventListener("click",()=>{
  if(spinning) return;
  spinning = true;
  resultEl.textContent = "";

  spinWheel(currentSegments,(category)=>{
    currentSegments = categories[category];
    spinWheel(currentSegments,(product)=>{
      resultEl.textContent = Вы выбрали: ${product};
      winSound.play();
      currentSegments = Object.keys(categories);
      drawWheel(currentSegments);
      spinning = false;
    });
  });
});

// ====== Инициализация ======
drawWheel(currentSegments);
</script>

</body>
</html>